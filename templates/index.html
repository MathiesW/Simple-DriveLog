{% extends "base.html" %}

{% block title %}Tank-Logger{% endblock %}

{% block content %}
<h1>Willkommen zum Tank-Logger</h1>
<p>Gewähltes Fahrzeug: {{ selected_fahrzeug or "Keines ausgewählt" }}</p>

<!-- Eintrag-Formular -->
<form method="post" action="{{ url_for('edit', fahrzeug=selected_fahrzeug, id=edit_row['id']) if edit_row else url_for('neu', fahrzeug=selected_fahrzeug) }}">
    <div class="mb-2">
        <label>Event:</label>
        <select name="event" id="eventSelect" class="form-select">
            <option value="Tanken" {% if edit_row and edit_row['event']=="Tanken" %}selected{% endif %}>Tanken</option>
            <option value="Wartung" {% if edit_row and edit_row['event']=="Wartung" %}selected{% endif %}>Wartung</option>
            <option value="Anderes" {% if edit_row and edit_row['event']=="Anderes" %}selected{% endif %}>Anderes</option>
        </select>
    </div>
    <div class="mb-2">
        <label>Datum:</label>
        <input type="date" name="datum" value="{{ edit_row['datum'] if edit_row else today }}" class="form-control">
    </div>
    <div class="mb-2">
        <label>Kilometer:</label>
        <input type="number" name="kilometer" value="{{ edit_row['kilometer'] if edit_row else last_km }}" class="form-control">
    </div>
    <div class="mb-2 tank-field">
        <label>Liter:</label>
        <input type="number" step="0.01" name="liter" value="{{ edit_row['liter'] if edit_row else '' }}" class="form-control">
        <label>Preis pro Liter:</label>
        <input type="number" step="0.01" name="preis_pro_liter" value="{{ edit_row['preis_pro_liter'] if edit_row else '' }}" class="form-control">
    </div>
    <div class="mb-2 cost-field" style="display:none;">
        <label>Kosten:</label>
        <input type="number" step="0.01" name="kosten" value="{{ edit_row['kosten'] if edit_row else '' }}" class="form-control">
    </div>
    <div class="mb-2">
        <label>Kommentar:</label>
        <input type="text" name="kommentar" value="{{ edit_row['kommentar'] if edit_row else '' }}" class="form-control">
    </div>
    <button type="submit" class="btn btn-primary">
        {% if edit_row %}Änderungen speichern{% else %}Speichern{% endif %}
    </button>
</form>


<hr>

<!-- Tabelle der Einträge -->
<h2>Einträge</h2>
<table class="table table-dark table-striped">
    <thead>
        <tr>
            <th>Datum</th>
            <th>Event</th>
            <th>Kilometer</th>
            <th>Liter</th>
            <th>Preis/L</th>
            <th>Kosten</th>
            <th>Kommentar</th>
            <th>Aktionen</th>
        </tr>
    </thead>
    <tbody>
        {% for row in rows %}
        <tr>
            <td>{{ row.datum }}</td>
            <td>{{ row.event }}</td>
            <td>{{ row.kilometer }}</td>
            <td>{{ row.liter }}</td>
            <td>{{ row.preis_pro_liter }}</td>
            <td>{{ row.kosten }}</td>
            <td>{{ row.kommentar }}</td>
            <td>
                <form method="get" action="{{ url_for('edit', fahrzeug=selected_fahrzeug, id=row.id) }}" style="display:inline;">
                    <button type="submit" class="btn btn-warning btn-sm">Edit</button>
                </form>
                <form method="post" action="{{ url_for('delete', fahrzeug=selected_fahrzeug, id=row.id) }}" style="display:inline;">
                    <button type="submit" class="btn btn-danger btn-sm">Löschen</button>
                </form>
                <!-- <a href="{{ url_for('edit', fahrzeug=selected_fahrzeug, id=row.id) }}" class="btn btn-warning btn-sm">Edit</a> -->
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const eventSelect = document.getElementById("eventSelect");
    const tankFields = document.querySelectorAll(".tank-field");
    const costField = document.querySelector(".cost-field");

    function toggleFields() {
        if (eventSelect.value === "Tanken") {
            tankFields.forEach(el => el.style.display = "block");
            costField.style.display = "none";
        } else if (eventSelect.value === "Wartung") {
            tankFields.forEach(el => el.style.display = "none");
            costField.style.display = "block";
        } else {
            tankFields.forEach(el => el.style.display = "none");
            costField.style.display = "block";
        }
    }

    eventSelect.addEventListener("change", toggleFields);
    toggleFields(); // einmal initial aufrufen
});
</script>

{% endblock %}
